const loading_data = `<div class="socket">
    <div class="gel center-gel">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c1 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c2 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c3 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c4 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c5 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c6 r1">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>

    <div class="gel c7 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>

    <div class="gel c8 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c9 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c10 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c11 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c12 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c13 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c14 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c15 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c16 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c17 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c18 r2">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c19 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c20 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c21 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c22 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c23 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c24 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c25 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c26 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c28 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c29 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c30 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c31 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c32 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c33 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c34 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c35 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c36 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>
    <div class="gel c37 r3">
        <div class="hex-brick h1"></div>
        <div class="hex-brick h2"></div>
        <div class="hex-brick h3"></div>
    </div>

</div>

<h5 class="loading-tag">Loading ...</h5>`


const normal_data = `            <div class="map h-100 w-100 col-lg-12">{{ map|safe }}</div>

            <div class="container-fluid d-flex hero-contents">
                <div class="display-card d-block" id="small-info">
                    <h5 class="ps-2 pt-2">School Accesibility Walk</h5>
                    <div class="divider"></div>
                    <p class="ps-2 pe-1">
                        How easy it is to access schools, jobs and hospitals across the city. Select the layer of
                        interest e.g schools to view the map of school accessibility.
                    </p>
                </div>

                <div
                    id="query-layer"
                    class="layer-control pt-3 ps-2 pe-2 shadow-lg ms-2 ms-2 mt-2 rounded-top d-flex flex-column col-lg-4 visually-hidden"
                >
                    <button
                        type="button"
                        class="btn-close align-self-end"
                        aria-label="Close"
                        onclick="hideQueryLayer()"
                    ></button>
                    <h5 id="layer-title">Accessibility</h5>
                    <p class="ps-2 text-dark" id="layer-info">
                        How easy it is to access schools, jobs and hospitals across the city. Select the layer of
                        interest e.g schools to view the map of school accessibility For more information about how
                        accessibility is measured. Go to our
                        <span> <a href="#">methodology section.</a></span>
                    </p>

                    <div class="container mt-3">
                        <h5>Query Layer</h5>
                        <form method="post" id="send-layer-info" class="form">
                            {% csrf_token %}
                            <div class="form-group">
                                <label
                                    for="layerSelect"
                                    class="text-primary-emphasis"
                                    title="The layer you want to visualize, nrbjaaccess: Nairobi job access index"
                                >
                                    Select Layer Name
                                </label>
                                <select class="form-control" id="layerSelect">
                                    {% for option, value in layer_options.items %}
                                    <option value="{{ option }}" title="{{ value }}">{{ value }}</option>
                                    {% endfor %}
                                </select>
                                <label
                                    for="AttributeSelect"
                                    class="text-primary-emphasis"
                                    title="The attribute to associate with the layer eg: entropy_fn"
                                >
                                    Select attribute
                                </label>
                                <select class="form-control" id="AttributeSelect">
                                    {% for option in attribute_options %}
                                    <option value="{{ option }}" title="{{option}}">{{option}}</option>
                                    {% endfor %}
                                </select>

                                <button
                                    type="submit"
                                    class="btn btn-md bg-primary mt-2 w-100 text-white"
                                    id="get-layer-btn"
                                >
                                    Get Layer
                                </button>
                            </div>
                        </form>
                    </div>

                    <p class="ps-2 mt-2 pt-5 text-dark">
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Error vitae animi esse officia quis
                        excepturi, laborum exercitationem omnis accusantium quam cum dolore illum alias modi. Omnis
                        nostrum suscipit libero quas?
                    </p>
                </div>
            </div>

            <div class="comments rounded-top visually-hidden" id="comments">
                <div class="messages">
                    <div class="comment-tag bg-primary rounded m-2">
                        <h6 class="commenters-name m-2 pt-3 text-warning">John Ngugi</h6>
                        <p class="comment-body m-2">The beds are too few!</p>
                        <small class="ms-5 text-sm">
                            - Posted on
                            <span><i>Mon Jun 17 2:35 pm</i></span>
                        </small>
                    </div>

                    <div class="comment-tag bg-primary rounded m-2">
                        <h6 class="commenters-name m-2 pt-3 text-success">Martin</h6>
                        <p class="comment-body m-2">The beds are too few!</p>
                        <small class="ms-5 text-sm">
                            - Posted on
                            <span><i>Thu Aug 22 4:50 pm</i></span>
                        </small>
                    </div>

                    <div class="comment-tag bg-primary rounded m-2">
                        <h6 class="commenters-name m-2 pt-3 text-success">Jane Omollo</h6>
                        <p class="comment-body m-2">The service time was Great</p>
                        <small class="ms-5 text-sm">
                            - Posted on
                            <span><i>Wed Jan 08 2:20 pm</i></span>
                        </small>
                    </div>

                    <div class="comment-tag bg-primary rounded m-2">
                        <h6 class="commenters-name m-2 text-success">John Ngugi</h6>
                        <p class="comment-body m-2">The place was great!</p>
                        <small class="ms-5 text-sm">
                            - Posted on
                            <span><i>Fri Jul 19 7:45 am</i></span>
                        </small>
                    </div>
                </div>
                <hr class="dropdown-divider" />
                <form action method="post">
                    {% csrf_token %}
                    <div>
                        <label for="Textarea" class="form-label text-primary ms-2">Leave Comment</label>
                        <textarea class="form-control" id="Textarea" rows="2"></textarea>
                    </div>
                    <div class="d-flex">
                        <button type="submit" class="btn btn-primary bg-primary btn-sm mt-1 ms-2 w-25 text-white">
                            Submit
                        </button>
                        <button
                            type="button"
                            id="close-comment-btn"
                            class="btn btn-danger bg-danger btn-sm mt-1 w-25 ms-2 text-white close-comment-btn"
                        >
                            Close
                        </button>
                    </div>
                </form>
            </div>`


// Select the form and button elements
const form = document.getElementById('send-layer-info');
const submitButton = document.getElementById('get-layer-btn');
const mapDiv = document.querySelector(".map");
// Add an event listener to the form submit event
form.addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission
    document.querySelector('.top-section').innerHTML=loading_data
    // Get selected values from the form
    const layerSelect = document.getElementById('layerSelect').value;
    const attributeSelect = document.getElementById('AttributeSelect').value;

    // Construct the data object to be sent
    const data = {
        layerSelect: layerSelect,
        attributeSelect: attributeSelect
    };

    // Make a POST request using Fetch API
    fetch('get-layer/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken') // Include CSRF token
        },
        body: JSON.stringify(data) // Convert data to JSON string
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json(); // Parse JSON response
    })
    .then(data => {
        console.log('Success:', data);
        document.querySelector('.top-section').innerHTML= normal_data
        // Handle success response here if needed
        mapDiv.innerHTML = data.map
    })
    .catch(error => {
        console.error('Error:', error);
        // Handle error here
    })
    .catch(error => {
        document.querySelector('.top-section').innerHTML= normal_data
        // Handle error here
    })
    .finally(() => {
        // Hide the loading screen
        document.getElementById('loadingScreen').style.display = 'none';
    });;
});

// Function to get CSRF token from cookie
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Extract CSRF token from cookie
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showQueryLayer() {
    document.getElementById('small-info').style.display = 'none';
    document.getElementById('query-layer').classList.remove('visually-hidden');
}

function hideQueryLayer() {
    document.getElementById('small-info').classList.remove('visually-hidden')
    document.getElementById('query-layer').classList.add('visually-hidden');
}



const maps = document.querySelectorAll(".layer-identifier")
const layerTitle = document.getElementById("layer-title");
const layerInfo = document.getElementById('layer-info');


maps.forEach((map)=>{
    console.log(map)
    map.addEventListener('click',()=>  {
        var name = map.text
        console.log("name" , name)
        layerTitle.innerText = name
    })

})



function getLayerInfo(){





}





// const commentsBox = document.getElementById('comments');
// const boxOpener = document.getElementById('box-opener');
// const closeFormBtn = document.getElementById("close-comment-btn")

// boxOpener.addEventListener('click', ()=> {
//         commentsBox.style.display = Flex;
//     })

// closeFormBtn.addEventListener('click',()=>{
//     commentsBox.style.display = 'None'
// })

 /*

  Facility hospital access index
  select between hosital and school (simplified)
  add in a changing opacity*
  add in the overlay for neighbourhoods
  separate the reseach papers
  list of papers
  datasets our datsets
  open linksto open data
  scrapped data inder datasets
  Themes {accessibility opportunity , network analiys properties, zoning }

   sdna = [ mad(clossness centarlity)  diva(sevierance/ separation) len(density) halr(efficiency) tpbta(2 faced-betweenness centrality) ] 1500 = 1.5 killomitres

   density , design(sdna),  opportunity , diversity(entropy), acceccibitlity, distance to public transport , population density
   short description of the layers i.e dates of aquiry for the hospitals ,
   send a layer with shops, mpesa but for now use the ones from OSM


   have a menu where people choose what the person is satisfied and uncertisfied with.
   so that people in the medical or whatever field to have better services.

   have a closed ended and open ended approach to facilities(level of satisfaction)

   feedback- contact page


 */
